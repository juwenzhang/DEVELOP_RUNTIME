# AsyncInsight 适配器测试结果汇总

基于本次实验测试，以下是 Koa、Fastify 和 Express 框架适配器的测试结果对比表格：

| 框架 | 测试结果 | 需要的修改 | 测试端点 | 启动端口 | 备注 |
|------|----------|------------|----------|----------|------|
| Koa | ✅ 成功 | 1. 修复导入问题<br>2. 禁用资源泄漏检测 | /api/context<br>/api/async<br>/api/nested<br>/metrics | 5000 | 所有测试端点正常返回200状态码，上下文传递功能正常 |
| Express | ✅ 成功 | 1. 修复导入问题 | /api/context<br>/api/async<br>/api/nested<br>/metrics | 5001 | 所有测试端点正常返回200状态码，上下文传递功能正常 |
| Fastify | ✅ 成功 | 1. 降级到兼容版本 (v4.28.1)<br>2. 修复导入问题<br>3. 禁用资源泄漏检测<br>4. 修复IPv6解析问题 | /api/context<br>/api/async<br>/api/nested<br>/metrics | 5002 | 所有测试端点正常返回200状态码，使用127.0.0.1替代localhost解决连接问题 |

## 测试说明

1. **测试方法**：所有适配器测试脚本都添加了自动化测试功能，能够自动启动服务器、发送请求验证各端点功能，并在测试完成后自动关闭服务器。

2. **禁用资源泄漏检测**：在所有测试中都禁用了资源泄漏检测功能，以避免潜在的循环引用问题。

3. **Fastify版本兼容性**：由于当前环境使用的是Node.js v18.20.8，需要将Fastify版本从5.6.1降级到4.28.1以确保兼容性。

4. **IPv6解析问题**：在Fastify测试中发现localhost解析为IPv6地址(::1)导致连接问题，通过使用127.0.0.1解决了此问题。

## 自动化测试功能

所有测试脚本都包含以下自动化测试功能：

- 自动启动服务器
- 依次测试四个端点：基础上下文、异步操作上下文、嵌套异步函数上下文和指标端点
- 验证每个端点的响应状态码和内容
- 测试完成后自动关闭服务器

这种自动化测试方式大大提高了测试的便利性和可靠性。